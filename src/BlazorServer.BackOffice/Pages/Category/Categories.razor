@page "/category"
@using BlazorServer.BackOffice.Models.Category;
@inherits CategoriesBase
@attribute [Authorize(Policy = "RequireUserMercadona")]

<CascadingValue Value="@LinkAddCategory">
    <AddButton></AddButton>
</CascadingValue>

<div>
    <MudTable Items="@Categories" Dense="false" Hover="true" CanCancelEdit="true" Elevation="10" Class="rounded-lg categories"
              CommitEditTooltip="Modifier"
              CancelEditTooltip="Annuler"
              Filter="new Func<Category,bool>(FilterFunc)"
              EditTrigger="TableEditTrigger.EditButton"
              RowEditPreview="BackupItem"
              RowEditCancel="ResetItemToOriginalValues"
              RowEditCommit="ItemHasBeenCommittedAsync">
        <ToolBarContent>
            <MudIcon Class="mr-2" Icon="@Icons.Material.TwoTone.Kitchen" Color="Color.Inherit" />
            <MudText Typo="Typo.h6">Liste des catégories</MudText>
            <MudSpacer />
            <MudTextField @bind-Value="searchString" Placeholder="Rechercher une catégorie" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
        </ToolBarContent>
        <ColGroup>
            <col />
            <col />
            <col />
            <col style="width:50px;" />
        </ColGroup>
        <HeaderContent>
            <MudTh>Nom</MudTh>
            <MudTh>Nb Articles</MudTh>
            <MudTh></MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Nom" style="margin-top: 0px!important;">@context.Name</MudTd>
            <MudTd DataLabel="Nb Articles">@context.NumberArticles</MudTd>
            <MudTd Style="text-align:right">
                <MudIconButton Size="Size.Small" Icon="@Icons.Material.Outlined.Delete" OnClick="@(() => DeleteCategory(@context.Id))">Supprimer</MudIconButton>
            </MudTd>
        </RowTemplate>
        <RowEditingTemplate>
            <MudTd DataLabel="Nom">
                <MudTextField @bind-Value="@context.Name" Required />
            </MudTd>
            <MudTd DataLabel="Nb Articles">@context.NumberArticles</MudTd>
            <MudTd></MudTd>
        </RowEditingTemplate>
        <PagerContent>
            @if (@displayRowNavigation)
            {
                <MudTablePager RowsPerPageString="Ligne par page" />
            }
        </PagerContent>
        <EditButtonContent Context="button">
            <MudIconButton Size="Size.Small" Icon="@Icons.Material.Outlined.Edit" OnClick="@button.ButtonAction" Disabled="@button.ButtonDisabled" />
        </EditButtonContent>
    </MudTable>
</div>

